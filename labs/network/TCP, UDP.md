# Протоколы транспортного уровня: TCP, UDP
## Задание Firewall
В рамках данной лабораторной работы сделаем базовые настройки МЭ для Linux.

Для выполнения этого ДЗ потребуются две виртуальные машины: Ubuntu и Kali

Запустим виртуальную машину Ubuntu и установим следующие программы:
- nginx - веб-сервер (возможность публикации веб-страниц)
- openssh-server - сервер ssh (Secure Shell - возможность управления с использованием интерпретатора команд на удалённом сервере)
- vsftpd - сервер ftp (File Transfer Protocol - протокол передачи файлов)

Установленные приложения запустятся после установки сразу в виде сервисов и откроют следующие порты:
- nginx откроет порт 80
- openssh-server откроет порт 22
- vsftpd откроет порт 21

По умолчанию в режиме NAT каждая VM работает изолированно. Поэтому нам необходимо внести некоторые изменения.
1. Настройте виртуальные машины согласнов видео (Ubuntu - 192.168.0.1, Kali - 192.168.0.2)
2. Проверьте, что всё работает, с помощью утилиты ping (обе VM должны быть запущены)
3. Запустите виртуальную машину Kali
4. Проверьте доступность сервисов, для этого воспользуйтесь программой telnet

Нам поступила задача закрыть FTP для доступа из сети, оставив открытыми только 80 и 22 порты. Для этого воспользуемся МЭ, входящим в состав Ubuntu и закроем доступ.
1. Перейдите в Ubuntu:
```
ubuntu@ubuntu:~$ sudo ufw status verbose
Status: inactive
# это означает, что МЭ выключен
```
2. Включите МЭ:
```
ubuntu@ubuntu:~$ sudo ufw enable
Firewall is active and enabled on system startup
```
3. Теперь МЭ работает, чтобы убедиться в этом, перейдите в Kali и повторите запросы telnet:
```
telnet 192.168.0.1 80
telnet 192.168.0.1 22
telnet 192.168.0.1 21
```
На все ваши попытки должен быть получен следующий ответ:
```
Trying 192.168.0.1...
```
Т.е. соединение не устанавливается.
4. Перейдите в Ubuntu и выполните следующие команды:
```
# разрешение http (порт 80)
ubuntu@ubuntu:~$ sudo ufw allow http
Rule added
Rule added (v6)

# разрешение ssh (порт 22)
ubuntu@ubuntu:~$ sudo ufw allow ssh
Rule added
Rule added (v6)
```
6. Вернитесь в Kali и проверьте команды telnet:
```
kali@kali:~$ telnet 192.168.0.1 80
Trying 192.168.0.1...
Connected to 192.168.0.1.
Escape character is '^]'.
^]
telnet> q
Connection closed.

kali@kali:~$ telnet 192.168.0.1 22
Trying 192.168.0.1...
Connected to 192.168.0.1.
Escape character is '^]'.
SSH-2.0-OpenSSH_7.6p1 Ubuntu-4ubuntu0.3
^]
telnet> q
Connection closed.
```
Попытка подключения к 21 порту закончится безуспешно.

Таким образом, мы познакомились с базовой работой МЭ, позволяющей открывать доступ к определённым портам. По умолчанию применяется правило "всё, что явно не разрешено - запрещено".

В качестве результата работы пришлите вывод команды sudo ufw status verbose.
#### Ответ:
- Status: active
- Logging: on (low)
- Default: deny (incoming), allow (outgoing), disabled (routed)
- New profiles: skip

| To        | Action   |       From |
|-----------|----------|-----------|
| 80/tcp  | ALLOW IN | Anywhere |
| 22/tcp   | ALLOW IN |   Anywhere |
| 80/tcp (v6)  | ALLOW IN |   Anywhere (v6) |
| 22/tcp (v6)  | ALLOW IN |   Anywhere (v6) |

## Задание Wireshark
Откройте в Kali Wireshark и проследите, как происходит процесс соединения при отключенном МЭ и при включенном (на 21 порт не стоит allow).

В качестве ответа опишите разницу в процессе установления соединения (или попытках установления соединения) при отключенном МЭ и при включенном МЭ (на 21 порт не стоит allow).
#### Ответ:
При открытом порте 21 Kali посылает SYN-пакет Ubuntu и в ответ Ubuntu посылает Kali SYN-пакет и ACK-пакет, Kali отвечает пакетом ACK. Kali посылает ARP запрос, на который отвечает Ubuntu. Соединение установлено.

При закрытом порте 21 Kali посылает SYN-пакет Ubuntu, но из-за закрытого порта 21 пакет не доходит до destination address. Kali посылает ARP запрос, на который не получает ответа. Соединение не установлено из-за закрытого порта 21.
