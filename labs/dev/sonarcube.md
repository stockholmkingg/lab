# Популярные языки, системы сборки, управления зависимостями
## Задание SonarQube
0. Скопируйте на целевую машину файл docker-compose.yml и откройте терминал в том же каталоге.

1. Запустите сервис SonarQube:
```
docker-composer up sonarqube
```
2. Дождитесь появления в логах записи SonarQube is up, после чего зайдите на http://localhost:9000.

3. Для входа используйте следующие учётные данные:
   - логин — admin
   - пароль — admin
4. На главной странице нажмите кнопку Create new project:
5. Введите ключ проекта (это нечто вроде кода проекта) и нажмите кнопку Setup:
6. Введите имя токена (ключа доступа) и нажмите на кнопку Generate:
7. После генерации токена нажмите на кнопку Continue:
8. Выберите опцию Maven и скопируйте сгенерированный код:

Необходимо скопировать вот этот код:
```
mvn sonar:sonar \
  -Dsonar.projectKey=ru.netology:ibdev \
  -Dsonar.host.url=http://ip172-18-0-13-c02u36plo55000cqjg9g-9000.direct.labs.play-with-docker.com \
  -Dsonar.login=2a820a891192340e52fbfb011c706ec798b03c76
```
И заменить в нём строку: <code>-Dsonar.host.url=http://ip172-18-0-13-c02u36plo55000cqjg9g-9000.direct.labs.play-with-docker.com \ </code>на <code>-Dsonar.host.url=http://sonarqube:9000 \ </code>.
9. Откройте новый терминал в том же каталоге, где у вас расположен файл docker-compose.yml.

10. Выполните следующие команды:
```
# скачиваем архив с приложением
wget https://raw.githubusercontent.com/netology-code/ibdev-homeworks/master/02_dev/assets/app.tgz
# распаковываем архив
tar -xvf app.tgz
```
11. Запустите контейнер со сборочной системой Maven:
```
docker-compose run maven mvn -f /app sonar:sonar \
      -Dsonar.projectKey=ru.netology:ibdev \
      -Dsonar.host.url=http://sonarqube:9000 \
      -Dsonar.login=2a820a891192340e52fbfb011c706ec798b03c76
```
Обратите внимание: начиная с <code>sonar:sonar</code> - это то, что вы скопировали на шаге 8, с тем изменением, что после <code>mvn</code> добавлена опция <code>-f /app</code>.

12. Дождитесь появления сообщения об окончании процесса:

13. Перейдите в веб-интерфейс SonarQube:

### Результаты выполнения:

#### Вопрос:
Какие баги были выявлены: количество, описание, почему SonarQube их считает багами? См. ссылку Why is this an issue?.
#### Ответ:
1 баг:
- Объявите новую переменную вместо повторного использования параметра <code>clean</code>.
- Хотя технически правильно назначать параметры из тел методов, выполнение этого до считывания значения параметра, скорее всего, является ошибкой. Вместо этого начальные значения параметров, перехваченных исключений и параметров foreach должны быть, если не обработаны как окончательные, то, по крайней мере, прочитаны перед переназначением.

#### Вопрос:
Какие уязвимости были выявлены: количество, категории, описание, почему SonarQube их считает уязвимостями?
#### Ответ:
1 уязвимость: 
- Добавьте защиту паролем для базы данных.
- Категории - OWASP Top 10 2017 Category A3 - Sensitive Data Exposure; MITRE, CWE-521 - Weak Password Requirements 
- SonarQube считает это уязвимостью потому, что использование базы данных без пароля это явный показатель того, что база данных не защищена должным образом.

#### Вопрос:
Какие Security Hotspots были выявлены: количество, категории, приоритет, описание, почему SonarQube их считает Security HotSpot'ами?
#### Ответ:
1 Security HotSpot: 
- Убедитесь в том, что функция для отладки кода отключена перед добавлением в прод.
- Приоритет - Low.
- Категория - Insecure Configuration.
- SonarQube считает это Security HotSpot’ом потому, что запуск кода в прод с активированными функциями отладки чувствителен к требованиям безопасности.

#### Вопрос:
К каким CWE идёт отсылка для Security Hotspots из п. 2? См. вкладку How can you fix it? в нижней части страницы.
#### Ответ:
Список CWE:
- MITRE, CWE-489 - Leftover Debug Code
- MITRE, CWE-215 - Information Exposure Through Debug Information 

#### Вопрос:
Какие запахи кода были выявлены: количество, описание, почему SonarQube их считает запахами кода? См. ссылку Why is this an issue?.
#### Ответ:
1) Удалите неиспользуемый import <code>java.io.IOException</code>:
   - SonarQube считает это Code smell’ом потому, что Импортируемая часть файла должна обрабатываться IDE, а не разработчиком вручную, неиспользуемый импорт не должен оставаться в коде так, как их оставление снижает читаемость кода, поскольку их присутствие может сбивать с толку.
2) Замените <code>System.out</code> и <code>System.err</code> логгером
   - При логгировании сообщении необходимо соблюсти несколько важных требований:
     * Пользователь должен иметь возможность легко извлекать логи.
     * Формат всех зарегистрированных сообщений должен быть единообразным, чтобы пользователь мог легко читать логи.
     * Зарегистрированные данные действительно должны быть записаны.
     * Конфиденциальные данные должны регистрироваться только безопасно.

   - SonarQube считает это Code smell’ом потому, что программа напрямую записывает данные в стандартные выходные данные, нет абсолютно никакого способа соблюсти требования.
3) Удалите выражение, которое всегда равно <code>true</code>.
   - SonarQube считает это Code smell’ом потому, что если логическое выражение не изменяет оценку условия и не помешает выполнению программы, то оно может быть удалено.
4) Используйте более узкие исключения вместо универсальных.
   - SonarQube считает это Code smell’ом потому, что использование таких общих исключений, как <code>Error</code>, <code>RuntimeException</code>, <code>Throwable</code> и <code>Exception</code>, не позволяет вызывающим методам обрабатывать настоящие исключения, генерируемые системой.
5) Используйте более узкие исключения вместо универсальных.
   - SonarQube считает это Code smell’ом потому, что использование таких общих исключений, как <code>Error</code>, <code>RuntimeException</code>, <code>Throwable</code> и <code>Exception</code>, не позволяет вызывающим методам обрабатывать настоящие исключения, генерируемые системой отлично от ошибок, сгенерированных приложением.

